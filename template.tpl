___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Dito",
  "categories": [
    "SALES",
    "ANALYTICS",
    "MARKETING"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "Dito",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAfNElEQVR4Ae3dW4xV133H8eVLjYPNOE5LJAySjS1BGFqpNpex8hAGKeMHG9wWjFvGDx0eCthEQyrsiaIQeazQh0KQ4lGxgRfog0HCAimB5CEgMTRVa26tq9hDIDcigScyTWJx8QW7SfdvHzaZkBnmnP85a+219/5+pJENGU/mnLP2/q3/WmuvdcuDDz/1OwcAQINudQAAGBAgAAATAgQAYEKAAABMCBAAgAkBAgAwIUAAACYECADAhAABAJgQIAAAEwIEAGBCgAAATAgQAIAJAQIAMCFAAAAmBAgAwIQAAQCYECAAABMCBABgQoAAAEwIEACACQECADAhQAAAJgQIAMCEAAEAmBAgAAATAgQAYEKAAABMCBAAgAkBAgAwIUAAACYECADAhAABAJgQIAAAEwIEAGBCgAAATAgQAIAJAQIAMCFAAAAmBAgAwIQAAQCYECAAABMCBABgQoAAAEwIEACACQECADAhQAAAJgQIAMCEAAEAmBAgAAATAgQAYEKAAABMCBAAgAkBAgAwIUAAACYECADAhAABAJgQIAAAEwIEAGBCgAAATAgQAIAJAQIAMCFAAAAmBAgAwIQAAQCYECAAABMCBABgQoAAAEwIEACACQECADAhQAAAJgQIAMCEAAEAmBAgAAATAgQAYEKAAABMCBAAgAkBAgAwIUAAACYECADAhAABAJgQIAAAEwIEAGBCgAAATAgQAIAJAQIAMCFAAAAmBAgAwIQAAQCYECAAABMCBABgQoAAAEwIEACACQECADAhQAAAJgQIAMCEAAEAmBAgAAATAgQAYEKAAABMCBAAgAkBAgAwIUAAACYECADAhAABAJgQIAAAEwIEAGBCgAAATAgQAIAJAQIAMCFAAAAmBAgAwIQAAQCYECAAABMCBABgQoAAAEwIEACACQECADAhQAAAJgQIAMCEAAEAmBAgAAATAgQAYEKAAABMCBAAgMntDqWx5MlOt6l/jQvhoUeWuVZpm3SX61o4z3U8Mtt1zG130+77bPr3Fy+978698647dfqs23dg0L1x4m2Xt465s92u7f3Ot5e37XED2153QMwIEORq7aplrqd7URIiE//of9Pftc98IP1amoTjuXcuJDfVPW7v/kEHIH8ECHKhKuPVzS+k4VD/fzPZ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\u003d"
  },
  "description": "Tag that send the event data to Dito Ingestion API.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "platform",
    "displayName": "Platform",
    "selectItems": [
      {
        "value": "vtex",
        "displayValue": "Vtex"
      }
    ],
    "simpleValueType": true,
    "help": "Defines the source and shape of incoming events",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "requestHeaders",
    "displayName": "Request Headers",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "headers",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Key",
            "name": "key",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add Header"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "advancedOptions",
    "displayName": "Advanced Options",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "requestTimeout",
        "displayName": "Request Timeout",
        "simpleValueType": true,
        "defaultValue": 3000,
        "valueValidators": [
          {
            "type": "NON_NEGATIVE_NUMBER"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "emailHashAlgorithm",
        "displayName": "Email Hashing",
        "selectItems": [
          {
            "value": "sha1",
            "displayValue": "SHA1"
          },
          {
            "value": "sha256",
            "displayValue": "SHA256"
          }
        ],
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const sendHttpRequest = require("sendHttpRequest");
const getAllEventData = require("getAllEventData");
const makeInteger = require("makeInteger");
const makeString = require("makeString");
const JSON = require("JSON");
const Promise = require("Promise");
const getRequestHeader = require("getRequestHeader");
const log = require("logToConsole");
const getContainerVersion = require("getContainerVersion");
const getCookieValues = require("getCookieValues");
const setCookie = require('setCookie');
const getType = require("getType");
const getTimestampMillis = require("getTimestampMillis");
const Math = require("Math");

const containerVersion = getContainerVersion();

const postHeaders = {
  "Content-Type": "application/json",
};

let eventData = getAllEventData();
let cookieOptions = {
  domain: "auto",
  path: "/",
  samesite: "Lax",
  secure: true,
  "max-age": 31536000, // 1 year
  httpOnly: true,
};

if (data.headers) {
  for (let key in data.headers) {
    postHeaders[data.headers[key].key] = data.headers[key].value;
  }
}

let requestOptions = {
  headers: postHeaders,
  method: "POST",
};

if (data.requestTimeout) {
  requestOptions.timeout = makeInteger(data.requestTimeout);
}

eventData.timestamp = Math.floor(getTimestampMillis() / 1000);

maybeGetDitoUserId()
  .then((userId) => {
    if (userId !== null) {
      eventData.dito_user_id = userId;
    }
  })
  .then(() =>
    sendHttpRequest(
      "https://ingest.dito.com.br/v2/events/gtm/" + data.platform,
      requestOptions,
      JSON.stringify(eventData)
    )
  )
  .then((response) => {
    if (response.statusCode == 201) {
      data.gtmOnSuccess();
    } else {
      data.gtmOnFailure();
    }
  });

function maybeGetDitoUserId() {
  return Promise.create((resolve, reject) => {
    const ditoUserId = getCookieValues("ditouid")[0];
    if (ditoUserId) return resolve(ditoUserId);

    userEmailHash()
      .then((userId) => {
        if (userId !== null) {
          eventData.send_identify = true;
          setCookie("ditouid", makeString(userId), cookieOptions);
        }

        resolve(userId);
      })
      .catch((e) => reject(e));
  });
}

function userEmailHash() {
  if (data.platform === "vtex") {
    if (data.emailHashAlgorithm === "sha256") {
      return promiseResolve(eventData.emailHash);
    } else if (data.emailHashAlgorithm === "sha1") {
      const email = vtexUserEmail();
      if (email === null) return promiseResolve(null);

      const input = makeString(email).trim().toLowerCase();

      return sendHttpRequest(
        "https://ingest.dito.com.br/v2/utils/sha1-sum",
        requestOptions,
        JSON.stringify({ input: input })
      )
        .then((response) => {
          if (response.statusCode !== 200) return null;

          const body = JSON.parse(response.body);
          return body.output;
        })
        .catch((e) => {
          return null;
        });
    }
  }

  return promiseResolve(null);
}

function vtexUserEmail() {
  if (getType(eventData.visitorContactInfo) === "string") {
    eventData.visitorContactInfo = eventData.visitorContactInfo.split(',');
  }

  if (getType(eventData.visitorContactInfo) !== "array") return null;

  if (eventData.visitorContactInfo.length === 0) return null;

  return eventData.visitorContactInfo[0];
}

function promiseResolve(arg) {
  return Promise.create((resolve, _reject) => {
    resolve(arg);
  });
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://ingest.dito.com.br/v2/events/gtm/*"
              },
              {
                "type": 1,
                "string": "https://ingest.dito.com.br/v2/utils/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ditouid"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 10/7/2024, 3:56:36 PM


