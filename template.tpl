___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Dito",
  "categories": [
    "SALES",
    "ANALYTICS",
    "MARKETING"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Tag that send the event data to Dito Ingestion API.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "platform",
    "displayName": "Platform",
    "selectItems": [
      {
        "value": "vtex",
        "displayValue": "Vtex"
      }
    ],
    "simpleValueType": true,
    "help": "Defines the source and shape of incoming events",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "requestHeaders",
    "displayName": "Request Headers",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "headers",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Key",
            "name": "key",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add Header"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "advancedOptions",
    "displayName": "Advanced Options",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "requestTimeout",
        "displayName": "Request Timeout",
        "simpleValueType": true,
        "defaultValue": 3000,
        "valueValidators": [
          {
            "type": "NON_NEGATIVE_NUMBER"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "emailHashAlgorithm",
        "displayName": "Email Hashing",
        "selectItems": [
          {
            "value": "sha1",
            "displayValue": "SHA1"
          },
          {
            "value": "sha256",
            "displayValue": "SHA256"
          }
        ],
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const sendHttpRequest = require("sendHttpRequest");
const getAllEventData = require("getAllEventData");
const makeInteger = require("makeInteger");
const makeString = require("makeString");
const JSON = require("JSON");
const Promise = require("Promise");
const getRequestHeader = require("getRequestHeader");
const log = require("logToConsole");
const getContainerVersion = require("getContainerVersion");
const getCookieValues = require("getCookieValues");
const setCookie = require('setCookie');
const getType = require("getType");

const containerVersion = getContainerVersion();

const postHeaders = {
  "Content-Type": "application/json",
};

let eventData = getAllEventData();
let cookieOptions = {
  domain: "auto",
  path: "/",
  samesite: "Lax",
  secure: true,
  "max-age": 31536000, // 1 year
  httpOnly: true,
};

if (data.headers) {
  for (let key in data.headers) {
    postHeaders[data.headers[key].key] = data.headers[key].value;
  }
}

let requestOptions = {
  headers: postHeaders,
  method: "POST",
};

if (data.requestTimeout) {
  requestOptions.timeout = makeInteger(data.requestTimeout);
}

maybeGetDitoUserId()
  .then((userId) => {
    if (userId !== null) {
      eventData.dito_user_id = userId;
    }
  })
  .then(() =>
    sendHttpRequest(
      "https://ingest.dito.com.br/v2/events/gtm/" + data.platform,
      requestOptions,
      JSON.stringify(eventData)
    )
  )
  .then((response) => {
    if (response.statusCode == 201) {
      data.gtmOnSuccess();
    } else {
      data.gtmOnFailure();
    }
  });

function maybeGetDitoUserId() {
  return Promise.create((resolve, reject) => {
    const ditoUserId = getCookieValues("ditouid")[0];
    if (ditoUserId) return resolve(ditoUserId);

    userEmailHash()
      .then((userId) => {
        if (userId !== null) {
          eventData.send_identify = true;
          setCookie("ditouid", makeString(userId), cookieOptions);
        }

        resolve(userId);
      })
      .catch((e) => reject(e));
  });
}

function userEmailHash() {
  if (data.platform === "vtex") {
    if (data.emailHashAlgorithm === "sha256") {
      return promiseResolve(eventData.emailHash);
    } else if (data.emailHashAlgorithm === "sha1") {
      const email = vtexUserEmail();
      if (email === null) return promiseResolve(null);

      const input = makeString(email).trim().toLowerCase();

      return sendHttpRequest(
        "https://ingest.dito.com.br/v2/utils/sha1-sum",
        requestOptions,
        JSON.stringify({ input: input })
      )
        .then((response) => {
          if (response.statusCode !== 200) return null;

          const body = JSON.parse(response.body);
          return body.output;
        })
        .catch((e) => {
          return null;
        });
    }
  }

  return promiseResolve(null);
}

function vtexUserEmail() {
  if (getType(eventData.visitorContactInfo) === "string") {
    eventData.visitorContactInfo = eventData.visitorContactInfo.split(',');
  }

  if (getType(eventData.visitorContactInfo) !== "array") return null;

  if (eventData.visitorContactInfo.length === 0) return null;

  return eventData.visitorContactInfo[0];
}

function promiseResolve(arg) {
  return Promise.create((resolve, _reject) => {
    resolve(arg);
  });
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://ingest.dito.com.br/v2/events/gtm/*"
              },
              {
                "type": 1,
                "string": "https://ingest.dito.com.br/v2/utils/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ditouid"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 10/7/2024, 3:07:24 PM


